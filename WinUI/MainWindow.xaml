<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="AppleMusicRpc.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AppleMusicRpc"
    Title="Apple Music RPC"
    Closed="Window_Closed">

    <Grid>
        <!-- Normal Mode Content -->
        <Grid x:Name="NormalModeContent">
            <Grid.RowDefinitions>
                <RowDefinition Height="32" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Grid x:Name="AppTitleBar" Grid.Row="0" Background="Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="48" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- App Icon in title bar (above menu button area) -->
                <Image x:Name="TitleBarIcon" Grid.Column="0"
                       Width="18" Height="18"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Margin="2,1,0,0" />

                <TextBlock Grid.Column="1"
                           Text="Apple Music RPC"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           VerticalAlignment="Center"
                           Margin="4,0,0,0" />
            </Grid>

            <NavigationView
                x:Name="NavView"
                Grid.Row="1"
                IsBackButtonVisible="Collapsed"
                IsSettingsVisible="False"
                IsPaneToggleButtonVisible="True"
                PaneDisplayMode="LeftCompact"
                OpenPaneLength="200"
                CompactPaneLength="48"
                SelectionChanged="NavView_SelectionChanged">

                <NavigationView.MenuItems>
                    <NavigationViewItem Content="Now Playing" Tag="NowPlaying" IsSelected="True"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE768;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                    <NavigationViewItem Content="History" Tag="History"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE81C;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                    <NavigationViewItem Content="Statistics" Tag="Statistics"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE9D9;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                    <NavigationViewItem Content="Connections" Tag="Connections"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE703;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                    <NavigationViewItemSeparator />
                    <NavigationViewItem Content="Appearance" Tag="Appearance"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE790;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                    <NavigationViewItem Content="Shortcuts" Tag="Shortcuts"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE765;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                    <NavigationViewItem Content="Mini Mode" Tag="MiniMode"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE73F;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                    <NavigationViewItemSeparator />
                    <NavigationViewItem Content="Settings" Tag="Settings"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE713;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                </NavigationView.MenuItems>

                <NavigationView.FooterMenuItems>
                    <NavigationViewItem Content="About" Tag="About"
                                        ToolTipService.ToolTip="{x:Null}">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE946;" />
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                </NavigationView.FooterMenuItems>

                <Frame x:Name="ContentFrame" Padding="24" />
            </NavigationView>
        </Grid>

        <!-- Mini Mode Content -->
        <Grid x:Name="MiniModeContent" Visibility="Collapsed"
              PointerEntered="MiniMode_PointerEntered"
              PointerExited="MiniMode_PointerExited">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Main content area -->
            <Grid Grid.Row="0" Padding="12,8,12,4" ColumnSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="48" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Album Art -->
                <Border Grid.Column="0" Width="48" Height="48" CornerRadius="6"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                    <Grid>
                        <FontIcon x:Name="MiniPlaceholderIcon" Glyph="&#xE93C;" FontSize="20"
                                  Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        <Image x:Name="MiniAlbumArt" Stretch="UniformToFill" />
                    </Grid>
                </Border>

                <!-- Track Info -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                    <TextBlock x:Name="MiniTrackTitle" Text="Not playing"
                               Style="{StaticResource BodyStrongTextBlockStyle}"
                               TextTrimming="CharacterEllipsis"
                               MaxLines="1" />
                    <TextBlock x:Name="MiniTrackArtist" Text=""
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextTrimming="CharacterEllipsis"
                               MaxLines="1" />
                </StackPanel>

                <!-- Expand Button (shows on hover) -->
                <Button x:Name="ExpandButton" Grid.Column="2"
                        Click="ExpandButton_Click"
                        Opacity="0"
                        Width="32" Height="32"
                        Padding="0"
                        VerticalAlignment="Center"
                        Background="Transparent"
                        BorderThickness="0"
                        ToolTipService.ToolTip="Expand">
                    <FontIcon Glyph="&#xE740;" FontSize="14" />
                </Button>
            </Grid>

            <!-- Progress Bar -->
            <ProgressBar x:Name="MiniProgressBar" Grid.Row="1"
                         Minimum="0" Maximum="100" Value="0"
                         Height="3"
                         Margin="12,0,12,8"
                         CornerRadius="1.5" />
        </Grid>
    </Grid>
</Window>
