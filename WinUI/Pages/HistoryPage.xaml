<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="AppleMusicRpc.Pages.HistoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Background="Transparent">

    <Grid RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock
            Grid.Row="0"
            Text="History"
            Style="{StaticResource TitleTextBlockStyle}" />

        <!-- Action Buttons - Only visible when history exists -->
        <StackPanel x:Name="ActionButtons" Grid.Row="1" Orientation="Horizontal" Spacing="8" Visibility="Collapsed">
            <Button x:Name="CopyAllButton" Click="CopyAllButton_Click">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE8C8;" FontSize="14" />
                    <TextBlock Text="Copy All" />
                </StackPanel>
            </Button>
            <Button x:Name="ClearButton" Click="ClearButton_Click">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE74D;" FontSize="14" />
                    <TextBlock Text="Clear" />
                </StackPanel>
            </Button>
        </StackPanel>

        <!-- Empty State -->
        <StackPanel
            x:Name="EmptyState"
            Grid.Row="2"
            VerticalAlignment="Center"
            HorizontalAlignment="Center"
            Spacing="8">
            <FontIcon
                Glyph="&#xE81C;"
                FontSize="48"
                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                HorizontalAlignment="Center" />
            <TextBlock
                Text="No history yet"
                Style="{StaticResource SubtitleTextBlockStyle}"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                HorizontalAlignment="Center" />
            <TextBlock
                Text="Play some music in Apple Music to see your listening history"
                Style="{StaticResource CaptionTextBlockStyle}"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                HorizontalAlignment="Center"
                TextAlignment="Center" />
        </StackPanel>

        <!-- History List -->
        <ListView
            x:Name="HistoryList"
            Grid.Row="2"
            SelectionMode="Single"
            Visibility="Collapsed"
            DoubleTapped="HistoryList_DoubleTapped"
            RightTapped="HistoryList_RightTapped">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="8,12" ColumnSpacing="12"
                          PointerEntered="HistoryItem_PointerEntered"
                          PointerExited="HistoryItem_PointerExited">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <FontIcon
                            Grid.Column="0"
                            Glyph="&#xE8D6;"
                            FontSize="16"
                            Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        <TextBlock
                            Grid.Column="1"
                            Text="{Binding}"
                            TextTrimming="CharacterEllipsis"
                            VerticalAlignment="Center" />
                        <Button
                            Grid.Column="2"
                            Tag="{Binding}"
                            Click="CopyItemButton_Click"
                            ToolTipService.ToolTip="Copy"
                            Opacity="0"
                            Padding="6"
                            Background="Transparent"
                            BorderThickness="0">
                            <FontIcon Glyph="&#xE8C8;" FontSize="12" />
                        </Button>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Context Menu -->
        <Grid.Resources>
            <MenuFlyout x:Name="ContextMenu">
                <MenuFlyoutItem Text="Copy" Click="CopySelectedButton_Click">
                    <MenuFlyoutItem.Icon>
                        <FontIcon Glyph="&#xE8C8;" />
                    </MenuFlyoutItem.Icon>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="Search on Google" Click="SearchButton_Click">
                    <MenuFlyoutItem.Icon>
                        <FontIcon Glyph="&#xE721;" />
                    </MenuFlyoutItem.Icon>
                </MenuFlyoutItem>
            </MenuFlyout>
        </Grid.Resources>
    </Grid>
</Page>
